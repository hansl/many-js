import { Info } from "./info";
import { Network } from ".";

const globalFetch = global.fetch;

/**
 * maybe need another way to mock this
 */
const mockResponse = new Uint8Array([
  210, 132, 88, 122, 163, 1, 39, 4, 88, 29, 1, 242, 255, 72, 27, 75, 209, 17,
  225, 228, 151, 248, 115, 27, 208, 13, 87, 221, 214, 227, 149, 247, 199, 242,
  4, 38, 189, 179, 65, 102, 107, 101, 121, 115, 101, 116, 88, 78, 129, 166, 1,
  1, 2, 88, 29, 1, 242, 255, 72, 27, 75, 209, 17, 225, 228, 151, 248, 115, 27,
  208, 13, 87, 221, 214, 227, 149, 247, 199, 242, 4, 38, 189, 179, 65, 3, 39, 4,
  129, 2, 32, 6, 33, 88, 32, 67, 93, 4, 206, 228, 2, 58, 102, 30, 135, 180, 194,
  67, 209, 54, 75, 50, 194, 229, 56, 174, 17, 168, 177, 178, 196, 122, 205, 128,
  222, 102, 142, 160, 88, 239, 217, 39, 18, 163, 1, 217, 39, 16, 88, 29, 1, 242,
  255, 72, 27, 75, 209, 17, 225, 228, 151, 248, 115, 27, 208, 13, 87, 221, 214,
  227, 149, 247, 199, 242, 4, 38, 189, 179, 65, 4, 88, 190, 163, 0, 130, 217,
  39, 16, 88, 29, 1, 74, 16, 29, 82, 29, 129, 2, 17, 160, 198, 52, 107, 168,
  155, 209, 204, 31, 130, 28, 3, 185, 105, 255, 157, 92, 139, 47, 89, 217, 39,
  16, 88, 32, 128, 74, 16, 29, 82, 29, 129, 2, 17, 160, 198, 52, 107, 168, 155,
  209, 204, 31, 130, 28, 3, 185, 105, 255, 157, 92, 139, 47, 89, 0, 0, 1, 1, 88,
  32, 144, 252, 143, 152, 228, 113, 150, 70, 241, 249, 129, 208, 244, 59, 119,
  48, 186, 182, 27, 109, 167, 128, 160, 56, 26, 20, 195, 119, 88, 57, 85, 254,
  4, 162, 217, 39, 16, 88, 29, 1, 74, 16, 29, 82, 29, 129, 2, 17, 160, 198, 52,
  107, 168, 155, 209, 204, 31, 130, 28, 3, 185, 105, 255, 157, 92, 139, 47, 89,
  99, 99, 98, 97, 217, 39, 16, 88, 32, 128, 74, 16, 29, 82, 29, 129, 2, 17, 160,
  198, 52, 107, 168, 155, 209, 204, 31, 130, 28, 3, 185, 105, 255, 157, 92, 139,
  47, 89, 0, 0, 1, 99, 97, 98, 99, 5, 193, 26, 98, 51, 202, 186, 88, 64, 210,
  98, 27, 94, 45, 106, 177, 9, 134, 44, 18, 180, 43, 82, 80, 176, 99, 176, 117,
  69, 197, 107, 157, 144, 194, 96, 118, 105, 255, 185, 32, 23, 78, 230, 56, 233,
  34, 60, 225, 28, 14, 77, 167, 138, 95, 228, 55, 216, 17, 55, 182, 250, 13, 50,
  26, 198, 175, 108, 102, 35, 214, 102, 209, 10,
]);

describe("info", () => {
  beforeAll(() => {
    global.fetch = jest.fn(() =>
      Promise.resolve({
        arrayBuffer: () => Promise.resolve(mockResponse),
      })
    ) as jest.Mock;
  });
  afterAll(() => {
    global.fetch = globalFetch;
  });
  it("should get ledger info", async () => {
    const testnet = new Network("http://example.com");
    // get the decoded cbor message
    const message = await testnet.call("ledger.info");
    // get ledger info from decoded cbor message
    const ledgerInfo = Info.getLedgerInfo(message);

    expect(ledgerInfo).toEqual({
      symbols: [
        {
          identity: "oaffbahksdwaqeenayy2gxke32hgb7aq4ao4wt745lsfs6wijp",
          name: "cba",
        },
        {
          identity: "oqbfbahksdwaqeenayy2gxke32hgb7aq4ao4wt745lsfs6wiaaaaqnz",
          name: "abc",
        },
      ],
    });
  });
});
